<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lani.dao.testDao">


	 <select id="selectMinimumWowzaIdx" parameterType="Map">
	SELECT
	   		A."WOWZA_INDEX" ,
	   		A."PRIVATE_IP",
	   		A."PORT_RTSP",
	   		A."WOWZA_STATUS"
	   		COALESCE(B."STREAMER_CNT", 0) as "CAM_COUNT"
		FROM
		(SELECT
				"WOWZA_INDEX" ,
				"PRIVATE_IP",
				"PORT_RTSP",
				"WOWZA_STATUS"
			FROM "VMS_WOWZA_SERVER_INFO" WHERE "WOWZA_STATUS"='Y') A
		LEFT JOIN
 		(SELECT "STREAMER_IDX", COUNT("STREAMER_IDX") AS "STREAMER_CNT" FROM "VMS_LIVE_STREAMER_ACC_INFO" WHERE "DEL_FLAG"='N' AND "LIVE_TYPE" = 'R' group by "STREAMER_IDX") B
 		ON A."WOWZA_INDEX"=B."STREAMER_IDX"
		ORDER BY "CAM_COUNT" , A."WOWZA_INDEX" LIMIT 1
   </select>


</mapper>